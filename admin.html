<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrar Productos - MicroUniversos</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap">
    <style>
        body {
            font-family: 'Source Code Pro', monospace;
            background-color: #f0f0f0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #000080;
        }
        form {
            margin-bottom: 20px;
        }
        form div {
            margin-bottom: 10px;
        }
        form label {
            display: block;
            margin-bottom: 5px;
        }
        form input, form textarea {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        form button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        form button:hover {
            background-color: #0000a0;
        }
        .product-list {
            list-style: none;
            padding: 0;
        }
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .product-item:last-child {
            border-bottom: none;
        }
        .product-item button {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .product-item button:hover {
            background-color: #cc0000;
        }
        .edit-button {
            background-color: #00cc00;
        }
        .edit-button:hover {
            background-color: #009900;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Administrar Productos</h1>
        <form id="product-form">
            <div>
                <label for="product-name">Nombre del Producto:</label>
                <input type="text" id="product-name" required>
            </div>
            <div>
                <label for="product-price">Precio:</label>
                <input type="number" id="product-price" required>
            </div>
            <div>
                <label for="product-quantity">Cantidad:</label>
                <input type="number" id="product-quantity" required>
            </div>
            <div>
                <label for="product-images">Imágenes (URLs, separadas por comas):</label>
                <input type="text" id="product-images" required>
            </div>
            <div>
                <label for="product-description">Descripción:</label>
                <textarea id="product-description"></textarea>
            </div>
            <div>
                <label for="product-code">Código de Ejemplo:</label>
                <textarea id="product-code"></textarea>
            </div>
            <button type="submit">Agregar Producto</button>
        </form>
        <ul id="product-list" class="product-list"></ul>
    </div>

    <script>
        // Verificación de acceso
        if (!localStorage.getItem('accessGranted')) {
            window.location.href = '/verify.html';
        }

        // Productos iniciales
        let products = [
            { id: 1, name: 'Bornera Pcb 2 Pines (x10)', price: 110, quantity: 3, images: ['Imagenes/1/1_1.png'], description: 'Bornera para conexión fácil.', code: '' },
            { id: 2, name: 'Display Led 8 Bit Max7219', price: 300, quantity: 10, images: ['Imagenes/2/2_1.png', 'Imagenes/2/2_2.png', 'Imagenes/2/2_3.png'], description: 'Display LED de 8 bits.', code: 'int main() { return 0; }' },
            { id: 3, name: 'Pantalla Tft De 1,8 Pulgadas', price: 430, quantity: 10, images: ['Imagenes/3/3_1.png'], description: 'Pantalla TFT de 1,8 pulgadas.', code: '' }
        ];
        let editingProductId = null;

        // Renderizar productos
        function renderProducts() {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';

            products.forEach(product => {
                const productItem = document.createElement('li');
                productItem.className = 'product-item';

                productItem.innerHTML = `
                    <span>${product.name} - $${product.price} - Cantidad: ${product.quantity}</span>
                    <span>
                        <button class="edit-button" onclick="editProduct(${product.id})">Editar</button>
                        <button onclick="deleteProduct(${product.id})">Eliminar</button>
                    </span>
                `;

                productList.appendChild(productItem);
            });
        }

        // Agregar producto
        function addProduct(event) {
            event.preventDefault();

            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const quantity = document.getElementById('product-quantity').value;
            const images = document.getElementById('product-images').value.split(',');
            const description = document.getElementById('product-description').value;
            const code = document.getElementById('product-code').value;

            if (editingProductId) {
                const product = products.find(p => p.id === editingProductId);
                product.name = name;
                product.price = price;
                product.quantity = quantity;
                product.images = images;
                product.description = description;
                product.code = code;

                editingProductId = null;
                document.querySelector('button[type="submit"]').textContent = 'Agregar Producto';
            } else {
                const newProduct = {
                    id: products.length + 1,
                    name,
                    price,
                    quantity,
                    images,
                    description,
                    code
                };
                products.push(newProduct);
            }

            document.getElementById('product-form').reset();
            renderProducts();
            updateProductsFile();
        }

        // Editar producto
        function editProduct(id) {
            const product = products.find(p => p.id === id);

            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-quantity').value = product.quantity;
            document.getElementById('product-images').value = product.images.join(',');
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-code').value = product.code;

            editingProductId = id;
            document.querySelector('button[type="submit"]').textContent = 'Guardar Producto';
        }

        // Eliminar producto
        function deleteProduct(id) {
            products = products.filter(p => p.id !== id);
            renderProducts();
            updateProductsFile();
        }

        // Actualizar archivo de productos
        function updateProductsFile() {
            fetch('/api/update-products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(products)
            }).then(response => {
                if (!response.ok) {
                    alert('Error al actualizar los productos');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('Error al actualizar los productos');
            });
        }

        // Inicializar eventos
        document.getElementById('product-form').addEventListener('submit', addProduct);

        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/get-products')
                .then(response => response.json())
                .then(data => {
                    products = data;
                    renderProducts();
                })
                .catch(error => {
                    console.error('Error al obtener los productos:', error);
                });
        });
    </script>
</body>
</html>
